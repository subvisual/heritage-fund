<%=
  render partial: "partials/page_title",
         locals: {
             model_object: @funding_application.project,
             page_title: t('dates.page_title')
         }
%>

<%=
  render partial: "partials/summary_errors",
         locals: {
             form_object: @funding_application.project,
             first_form_element: :start_date_day
         } if @funding_application.project.errors.any?
%>

<%=
  form_for @funding_application.project,
           url: :funding_application_gp_project_key_dates,
           method: :put do |f|
%>

  <div class="govuk-form-group <%= "govuk-form-group--error" if
                                       @funding_application.project.errors.any? %>">

    <h1 class="govuk-heading-xl">

      <span class="govuk-caption-xl">
        <%= t('views.funding_application.common.about_your_project') %>
      </span>

      <%= t('dates.page_heading') %>

    </h1>

    <% if flash[:date_warning] %>

      <div class="govuk-warning-text">
        <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
        <strong class="govuk-warning-text__text">
          <span class="govuk-warning-text__assistive">
            <%= t('generic.warning') %>
          </span>
          <%= flash[:date_warning] %>
        </strong>
      </div>

    <% end %>

    <div class="govuk-form-group">

      <fieldset class="govuk-fieldset" role="group"
                aria-describedby="project-start-hint">

        <legend id="project_start_date"
                class="govuk-fieldset__legend govuk-fieldset__legend--m">
          <%= t('dates.start_date.label') %>
        </legend>

        <span id="project-start-hint" class="govuk-hint">
          <%= t('dates.start_date.hint') %>
        </span>

        <% @funding_application.project.errors.each do |attr, msg| %>

          <% if attr.to_s.include? "start" %>

            <span id="project[<%= attr %>]-error" class="govuk-error-message">
              <span class="govuk-visually-hidden">
                <%= t('generic.error') %>:
              </span> <%= msg %>
            </span>

          <% end %>

        <% end %>

        <div class="govuk-date-input" id="start-date">

          <div class="govuk-date-input__item">

            <div class="govuk-form-group">

              <%=
                f.label :start_date_day,
                        t('dates.day'),
                        class: "govuk-label govuk-date-input__label"
              %>

              <%=
                render partial: "partials/date_input",
                       locals: {
                           form_object: @funding_application.project,
                           form_for_object: f,
                           model_attribute: :start_date,
                           input_name: :start_date_day,
                           input_width: 2,
                           date_type: "day"
                       }
              %>

            </div>

          </div>

          <div class="govuk-date-input__item">

            <div class="govuk-form-group">

              <%=
                f.label :start_date_month,
                        t('dates.month'),
                        class: "govuk-label govuk-date-input__label"
              %>

              <%=
                render partial: "partials/date_input",
                       locals: {
                           form_object: @funding_application.project,
                           form_for_object: f,
                           model_attribute: :start_date,
                           input_name: :start_date_month,
                           input_width: 2,
                           date_type: "month"
                       }
              %>

            </div>

          </div>

          <div class="govuk-date-input__item">

            <div class="govuk-form-group">

              <%=
                f.label :start_date_year,
                        t('dates.year'),
                        class: "govuk-label govuk-date-input__label"
              %>

              <%= render partial: "partials/date_input",
                         locals: {
                             form_object: @funding_application.project,
                             form_for_object: f,
                             model_attribute: :start_date,
                             input_name: :start_date_year,
                             input_width: 4,
                             date_type: "year"
                         }
              %>

            </div>

          </div>

        </div>

      </fieldset>

    </div>

    <div class="govuk-form-group">

      <fieldset class="govuk-fieldset" role="group"
                aria-describedby="project-end-hint">

        <legend id="project_end_date"
                class="govuk-fieldset__legend govuk-fieldset__legend--m">
          <%= t('dates.end_date.label') %>
        </legend>

        <span id="project-end-hint" class="govuk-hint">
          <%= t('dates.end_date.hint') %>
        </span>

        <% @funding_application.project.errors.each do |attr, msg| %>

          <% if attr.to_s.include? "end" %>

            <span id="project[<%= attr %>]-error" class="govuk-error-message">
              <span class="govuk-visually-hidden">
                <%= t('generic.error') %>:
              </span> <%= msg %>
            </span>

          <% end %>

        <% end %>

        <div class="govuk-date-input" id="end-date">

          <div class="govuk-date-input__item">

            <div class="govuk-form-group">

              <%=
                f.label :end_date_day,
                        t('dates.day'),
                        class: "govuk-label govuk-date-input__label"
              %>

              <%=
                render partial: "partials/date_input",
                       locals: {
                           form_object: @funding_application.project,
                           form_for_object: f,
                           model_attribute: :end_date,
                           input_name: :end_date_day, input_width: 2,
                           date_type: "day"
                       }
              %>

            </div>

          </div>

          <div class="govuk-date-input__item">

            <div class="govuk-form-group">

              <%=
                f.label :end_date_month,
                        t('dates.month'),
                        class: "govuk-label govuk-date-input__label"
              %>

              <%=
                render partial: "partials/date_input",
                       locals: {
                           form_object: @funding_application.project,
                           form_for_object: f,
                           model_attribute: :end_date,
                           input_name: :end_date_month,
                           input_width: 2,
                           date_type: "month"
                       }
              %>

            </div>

          </div>

          <div class="govuk-date-input__item">

            <div class="govuk-form-group">

              <%=
                f.label :end_date_year,
                        t('dates.year'),
                        class: "govuk-label govuk-date-input__label"
              %>

              <%=
                render partial: "partials/date_input",
                       locals: {
                           form_object: @funding_application.project,
                           form_for_object: f,
                           model_attribute: :end_date,
                           input_name: :end_date_year,
                           input_width: 4,
                           date_type: "year"
                       }
              %>

            </div>

          </div>

        </div>

      </fieldset>

    </div>

  </div>

  <%= render(ButtonComponent.new(element: "input")) %>

<% end %>

<div class="govuk-inset-text">
  <%= t('dates.small_length_info') %>
</div>